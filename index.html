<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Ansible Playbook Builder</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
	<style>
		/* ... (previous styles) ... */
		.category-container {
			margin-bottom: 20px;
		}

		.category-title {
			font-size:     1.1em;
			font-weight:   500;
			margin-bottom: 10px;
			color:         #666;
		}

		.preset-grid {
			display:               grid;
			grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
			gap:                   10px;
			margin-bottom:         15px;
		}
	</style>

	<style>
		body {
			font-family: system-ui, -apple-system, sans-serif;
			max-width: 1200px;
			margin: 0 auto;
			padding: 20px;
			background: #f5f5f5;
		}
		.container {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 20px;
		}
		.panel {
			background: white;
			padding: 20px;
			border-radius: 8px;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}
		.form-group {
			margin-bottom: 15px;
		}
		label {
			display: block;
			margin-bottom: 5px;
			font-weight: 500;
		}
		input, select {
			width: 100%;
			padding: 8px;
			border: 1px solid #ddd;
			border-radius: 4px;
			box-sizing: border-box;
		}
		button {
			background: #4CAF50;
			color: white;
			padding: 10px 15px;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			margin-right: 8px;
			margin-bottom: 8px;
		}
		button:hover {
			background: #45a049;
		}
		.output {
			white-space: pre-wrap;
			font-family: monospace;
			background: #2b2b2b;
			color: #fff;
			padding: 15px;
			border-radius: 4px;
			overflow-x: auto;
		}
		.tasks-container {
			border: 1px solid #ddd;
			padding: 15px;
			margin-bottom: 15px;
			border-radius: 4px;
		}
		.remove-task {
			background: #ff4444;
		}
		.add-task {
			background: #2196F3;
			margin-bottom: 20px;
		}
		.preset-btn {
			background: #9c27b0;
		}
		.preset-container {
			margin-bottom: 20px;
			padding: 15px;
			background: #f8f9fa;
			border-radius: 4px;
		}
		.task-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 10px;
		}
	</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
	const repo = 'DevShedLabs/DeployPackages';

	const presetCategories = {
		databases:  {
			name: "Databases",
			url:  `https://cdn.jsdelivr.net/gh/${repo}@main/presets-databases.json`
		},
		languages:  {
			name: "Programming Languages",
			url:  `https://cdn.jsdelivr.net/gh/${repo}@main/presets-languages.json`
		},
		webservers: {
			name: "Web Servers",
			url:  `https://cdn.jsdelivr.net/gh/${repo}@main/presets-servers.json`
		}
	};
	function AnsibleBuilder() {
		const [ playbookName, setPlaybookName ] = React.useState( 'my-playbook' );
		const [ hosts, setHosts ]               = React.useState( 'all' );
		const [ become, setBecome ]             = React.useState( true );
		const [ tasks, setTasks ]               = React.useState( [] );
		const [ copySuccess, setCopySuccess ]   = React.useState( false );
		const [ presets, setPresets ]           = React.useState( {} );
		const [ loading, setLoading ]           = React.useState( {} );
		const [ errors, setErrors ]             = React.useState( {} );

		React.useEffect( () => {
			// Load all preset categories
			Object.entries( presetCategories ).forEach( ( [ category, info ] ) => {
				loadPresetCategory( category );
			} );
		}, [] );

		const loadPresetCategory = async ( category ) => {
			setLoading( prev => ( { ...prev, [ category ]: true } ) );
			try {
				const response = await fetch( presetCategories[ category ].url );
				if ( !response.ok ) throw new Error( `HTTP error! status: ${response.status}` );
				const categoryPresets = await response.json();
				setPresets( prev => ( { ...prev, [ category ]: categoryPresets } ) );
			} catch ( error ) {
				console.error( `Error loading ${category} presets:`, error );
				setErrors( prev => ( { ...prev, [ category ]: error.message } ) );
			} finally {
				setLoading( prev => ( { ...prev, [ category ]: false } ) );
			}
		};

		const addTask = ( task = null ) => {
			const newTask = task || {
				name: `task-${tasks.length + 1}`,
				apt:  { name: '', state: 'present' }
			};
			setTasks( [ ...tasks, newTask ] );
		};

		const removeTask = ( index ) => {
			setTasks( tasks.filter( ( _, i ) => i !== index ) );
		};

		const updateTask = ( index, updates ) => {
			const newTasks    = [ ...tasks ];
			newTasks[ index ] = { ...newTasks[ index ], ...updates };
			setTasks( newTasks );
		};

		const applyPreset = ( preset ) => {
			preset.tasks.forEach( task => {
				const module = Object.keys( task ).find( key => key !== 'name' );
				if ( module ) {
					addTask( {
						name:       task.name,
						[ module ]: task[ module ]
					} );
				}
			} );
		};

		const generatePlaybook = () => {
			const playbook = [ {
				name:  playbookName,
				hosts,
				become,
				tasks: tasks.map( task => ( {
					name: task.name,
					...( Object.keys( task ).filter( key => key !== 'name' ).reduce( ( acc, key ) => ( {
						...acc,
						[ key ]: task[ key ]
					} ), {} ) )
				} ) )
			} ];
			return jsyaml.dump( playbook );
		};

		const copyToClipboard = async () => {
			try {
				await navigator.clipboard.writeText( generatePlaybook() );
				setCopySuccess( true );
				setTimeout( () => setCopySuccess( false ), 2000 );
			} catch ( err ) {
				console.error( 'Failed to copy:', err );
			}
		};

		const renderPresetCategory = ( category ) => {
			const categoryData = presets[ category ];
			if ( !categoryData ) return null;

			return (
					<div key={category} className="category-container">
						<div className="category-title">{presetCategories[ category ].name}</div>
						<div className="preset-grid">
							{Object.entries( categoryData ).map( ( [ key, preset ] ) => (
									<button
											key={key}
											className="preset-btn"
											onClick={() => applyPreset( preset )}
									>
										{preset.name}
									</button>
							) )}
						</div>
					</div>
			);
		};

		// ... (rest of the component render code remains the same)

		return (
				<div>
					<h1>Ansible Playbook Builder</h1>

					<div className="container">
						<div className="panel">
							<h2>Configuration</h2>

							<div className="form-group">
								<label>Playbook Name:</label>
								<input
										type="text"
										value={playbookName}
										onChange={( e ) => setPlaybookName( e.target.value )}
								/>
							</div>

							<div className="form-group">
								<label>Hosts:</label>
								<input
										type="text"
										value={hosts}
										onChange={( e ) => setHosts( e.target.value )}
								/>
							</div>

							<div className="form-group">
								<label>Become (sudo):</label>
								<select
										value={become.toString()}
										onChange={( e ) => setBecome( e.target.value === 'true' )}
								>
									<option value="true">Yes</option>
									<option value="false">No</option>
								</select>
							</div>

							<div className="preset-container">
								<h3>Quick Start Templates</h3>
								{Object.keys( presetCategories ).map( category =>
										loading[ category ] ? (
												<div key={category}>Loading {presetCategories[ category ].name}...</div>
										) : errors[ category ] ? (
												<div key={category}>Error
													loading {presetCategories[ category ].name}: {errors[ category ]}</div>
										) : (
													renderPresetCategory( category )
											)
								)}
							</div>

							{/* ... (rest of the task management UI remains the same) ... */}
						</div>

						<div className="panel">
							<h2>Generated Playbook</h2>
							<div className="output">{generatePlaybook()}</div>
							<button
									className="copy-button"
									onClick={copyToClipboard}
							>
								{copySuccess ? 'Copied!' : 'Copy to Clipboard'}
							</button>
						</div>
					</div>
				</div>
		);
	}

	// Render the app
	const root = ReactDOM.createRoot( document.getElementById( 'root' ) );
	root.render( <AnsibleBuilder /> );
</script>
</body>
</html>